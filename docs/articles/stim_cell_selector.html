<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stim Cell Selector • stimcellselector</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Stim Cell Selector">
<meta property="og:description" content="stimcellselector">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stimcellselector</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stim_cell_selector.html">Stim Cell Selector</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rohitfarmer/stimcellselector/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Stim Cell Selector</h1>
                        <h4 class="author">Rohit Farmer</h4>
            
            <h4 class="date">2020-07-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rohitfarmer/stimcellselector/blob/master/vignettes/stim_cell_selector.Rmd"><code>vignettes/stim_cell_selector.Rmd</code></a></small>
      <div class="hidden name"><code>stim_cell_selector.Rmd</code></div>

    </div>

    
    
<p>The primary function <code><a href="../reference/stim_cell_selector.html">stim_cell_selector()</a></code> in <code>stimcellselector</code> package follows a heuristic approach to group cells into responding and non-responding. For a combination of cell population and stimulation type (e.g., CD127+ T-helper cells and interferon-alpha), <code><a href="../reference/stim_cell_selector.html">stim_cell_selector()</a></code> starts by performing k-means clustering on the combined set of cells from stimulated and unstimulated samples. K-means clustering is performed on expression data of all the state markers combined. Upon clustering using a contingency table as drawn below, a Fisher’s exact test determines the effect size and the statistical significance of partitioning. Cells form the combinations that pass the Fisher’s exact test are considered as responding. An optional UMAP plot can also be generated to verify the cell partitioning in responding and non-responding groups visually.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1500</span>, <span class="fl">345</span>, <span class="fl">230</span>, <span class="fl">2500</span>),<span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>,
       <span class="kw">dimnames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Cluster1"</span>, <span class="st">"Cluster2"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Stim"</span>, <span class="st">"Unstim"</span>)))
<span class="co">#&gt;          Stim Unstim</span>
<span class="co">#&gt; Cluster1 1500    230</span>
<span class="co">#&gt; Cluster2  345   2500</span></pre></body></html></div>
<p>An optional UMAP plot can also be generated to verify the cell partitioning in responding and non-responding groups visually.</p>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>An example using the sample CyTOF data set <code>chi11_1k</code> included in the package. <code><a href="https://rdrr.io/r/base/message.html">suppressMessages()</a></code> is used to reduce the verbosity of the <code>stim_cell_selector</code> function.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stimcellselector</span>)
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>))
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>))
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>))

<span class="no">selected_data</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="../reference/stim_cell_selector.html">stim_cell_selector</a></span>(<span class="no">chi11_1k</span>$<span class="no">expr_data</span>, <span class="no">chi11_1k</span>$<span class="no">state_markers</span>,
                  <span class="no">chi11_1k</span>$<span class="no">cluster_col</span>, <span class="no">chi11_1k</span>$<span class="no">stim_label</span>,
                  <span class="no">chi11_1k</span>$<span class="no">unstim_label</span>, <span class="kw">seed_val</span> <span class="kw">=</span> <span class="fl">123</span>, <span class="kw">umap</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">umap_cells</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">selected_data</span>)
<span class="co">#&gt; [1] "list"</span>

<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span>(<span class="no">selected_data</span>)
<span class="co">#&gt; $names</span>
<span class="co">#&gt;  [1] "selected_expr_data"    "summary"              </span>
<span class="co">#&gt;  [3] "stacked_bar_plot_data" "umap_plot_data"       </span>
<span class="co">#&gt;  [5] "unstim_cells"          "state_markers"        </span>
<span class="co">#&gt;  [7] "cluster_col"           "stim_label"           </span>
<span class="co">#&gt;  [9] "unstim_label"          "seed_val"             </span>
<span class="co">#&gt; [11] "umap"                  "umap_cells"</span></pre></body></html></div>
<div id="output" class="section level3">
<h3 class="hasAnchor">
<a href="#output" class="anchor"></a>Output</h3>
<p><code><a href="../reference/stim_cell_selector.html">stim_cell_selector()</a></code> returns a list with the selected expression data, a summary, data to plot stacked bar plots to visualize the k-means and Fisher’s exact test results and data to plot the optional UMAPs.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">selected_data</span>$<span class="no">selected_expr_data</span>)
<span class="co">#&gt; # A tibble: 6 x 36</span>
<span class="co">#&gt;   cluster_id sample_id condition patient_id stim_type merging1  CD45   CD7</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1         94 CHI-011_… CHI       CHI-011    A         CD19 CD…  2.88  2.64</span>
<span class="co">#&gt; 2         83 CHI-011_… CHI       CHI-011    A         CD19 CD…  3.33  3.37</span>
<span class="co">#&gt; 3         93 CHI-011_… CHI       CHI-011    A         CD19 CD…  3.34  3.59</span>
<span class="co">#&gt; 4         93 CHI-011_… CHI       CHI-011    A         CD19 CD…  3.70  3.86</span>
<span class="co">#&gt; 5         93 CHI-011_… CHI       CHI-011    A         CD19 CD…  2.80  2.65</span>
<span class="co">#&gt; 6         93 CHI-011_… CHI       CHI-011    A         CD19 CD…  3.80  3.02</span>
<span class="co">#&gt; # … with 28 more variables: CD19 &lt;dbl&gt;, pPLCg2 &lt;dbl&gt;, CD4 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   IgD &lt;dbl&gt;, CD20 &lt;dbl&gt;, CD25 &lt;dbl&gt;, pSTAT5 &lt;dbl&gt;, CD123 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   AKT &lt;dbl&gt;, pSTAT1 &lt;dbl&gt;, CD27 &lt;dbl&gt;, pP38 &lt;dbl&gt;, CD24 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   pSTAT3 &lt;dbl&gt;, CD11c &lt;dbl&gt;, CD14 &lt;dbl&gt;, CD56 &lt;dbl&gt;, IkBa &lt;dbl&gt;,</span>
<span class="co">#&gt; #   pCREB &lt;dbl&gt;, CD16 &lt;dbl&gt;, CD38 &lt;dbl&gt;, CD8 &lt;dbl&gt;, CD45RA &lt;dbl&gt;,</span>
<span class="co">#&gt; #   CD3 &lt;dbl&gt;, pERK1_2 &lt;dbl&gt;, HLA_DR &lt;dbl&gt;, pS6 &lt;dbl&gt;, CD127 &lt;dbl&gt;</span></pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">selected_data</span>$<span class="no">summary</span>)
<span class="co">#&gt; # A tibble: 6 x 14</span>
<span class="co">#&gt;   cluster stim_type f_p_value fold_change pPLCg2 pSTAT5    AKT pSTAT1</span>
<span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;         &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 CD19 C… A          4.35e-24        0.69  0.245  1.89  0        2.09</span>
<span class="co">#&gt; 2 CD11c   A          1.35e- 2       -1.33  0      0     0        0   </span>
<span class="co">#&gt; 3 CD3 CD… A          5.19e-25        0.68  0.478  1.81  0        2.20</span>
<span class="co">#&gt; 4 CD3 CD… A          5.10e-20        0.62  0.302  1.52  0        1.83</span>
<span class="co">#&gt; 5 CD3 CD… A          1.44e-12        0.65  0.508  1.05  0.0627   1.56</span>
<span class="co">#&gt; 6 CD3 CD… A          1.55e- 2        0.44  0.416  0.614 0.0301   1.16</span>
<span class="co">#&gt; # … with 6 more variables: pP38 &lt;dbl&gt;, pSTAT3 &lt;dbl&gt;, IkBa &lt;dbl&gt;,</span>
<span class="co">#&gt; #   pCREB &lt;dbl&gt;, pERK1_2 &lt;dbl&gt;, pS6 &lt;dbl&gt;</span></pre></body></html></div>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">selected_data</span>$<span class="no">stacked_bar_plot_data</span>)
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   cluster stim_type  f_p_val stim_clust fold_change stim_status k_cluster</span>
<span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;    </span>
<span class="co">#&gt; 1 CD19 C… A         4.35e-24          2        0.69 unstim      cluster1 </span>
<span class="co">#&gt; 2 CD19 C… A         4.35e-24          2        0.69 unstim      cluster2 </span>
<span class="co">#&gt; 3 CD19 C… A         4.35e-24          2        0.69 stim        cluster1 </span>
<span class="co">#&gt; 4 CD19 C… A         4.35e-24          2        0.69 stim        cluster2 </span>
<span class="co">#&gt; 5 CD11c   A         1.35e- 2          1       -1.33 unstim      cluster1 </span>
<span class="co">#&gt; 6 CD11c   A         1.35e- 2          1       -1.33 unstim      cluster2 </span>
<span class="co">#&gt; # … with 1 more variable: count &lt;dbl&gt;</span></pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">selected_data</span>$<span class="no">umap_plot_data</span>)
<span class="co">#&gt; # A tibble: 6 x 7</span>
<span class="co">#&gt;   cluster        stim_type tot_of_cells no_of_cells UMAP1 UMAP2 cell_type  </span>
<span class="co">#&gt;   &lt;fct&gt;          &lt;fct&gt;     &lt;fct&gt;        &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;      </span>
<span class="co">#&gt; 1 CD19 CD20 CD4… A         3184         500            79   438 unstim_cel…</span>
<span class="co">#&gt; 2 CD19 CD20 CD4… A         3184         500            73    69 stim_cells…</span>
<span class="co">#&gt; 3 CD19 CD20 CD4… A         3184         500           105    84 stim_cells…</span>
<span class="co">#&gt; 4 CD19 CD20 CD4… A         3184         500           324   355 unstim_cel…</span>
<span class="co">#&gt; 5 CD19 CD20 CD4… A         3184         500           416   467 unstim_cel…</span>
<span class="co">#&gt; 6 CD19 CD20 CD4… A         3184         500           151   140 stim_cells…</span></pre></body></html></div>
</div>
<div id="figures" class="section level3">
<h3 class="hasAnchor">
<a href="#figures" class="anchor"></a>Figures</h3>
<div id="plots-explaining-k-means-clustering-fishers-exact-test-and-fold-change" class="section level4">
<h4 class="hasAnchor">
<a href="#plots-explaining-k-means-clustering-fishers-exact-test-and-fold-change" class="anchor"></a>Plots Explaining k-means Clustering, Fisher’s Exact Test, and Fold Change</h4>
<p>Using the <code>stacked_bar_plot_data</code>, bar plots can be plotted that shows for a given cluster and stimulation type the percentage of cells from the stimulated and unstimulated samples that are clustered in the two k-means clusters. <code>stacked_bar_plot_data</code> is returned for those combinations that pass the Fisher’s exact test after the k-means clustering. For each combination plot data also contains p-value for the Fisher’s exact test and the fold change of the cells from the stimulated samples that responded.</p>
<p>You can either use the function <code>plot_sbp</code> provided in the package to plot for all the combinations of cluster and stimulation types in a specified folder like below</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_sbp.html">plot_sbp</a></span>(<span class="no">selected_data</span>, <span class="no">path</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>or use the backend code below to plot only for the combinations of interest or with custom aesthetics. The code below only plots the first combination.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Group data according to clusters and stimulation type.</span>
<span class="no">group_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">selected_data</span>$<span class="no">stacked_bar_plot_data</span>, <span class="no">cluster</span>, <span class="no">stim_type</span>)

<span class="co"># Split groups into a list of individual tables.</span>
<span class="no">split_groups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span>(<span class="no">group_data</span>)

<span class="co"># Create ggplot for a single group.</span>
<span class="no">stacked_plot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">k_cluster</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">count</span>, <span class="kw">x</span><span class="kw">=</span><span class="no">stim_status</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">position</span><span class="kw">=</span><span class="st">"fill"</span>, <span class="kw">stat</span><span class="kw">=</span><span class="st">"identity"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Cluster:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">cluster</span>),
                   <span class="st">"; Stim type:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">stim_type</span>),
                   <span class="st">"\nFisher's p-value:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">f_p_val</span>),<span class="fl">3</span>),
                   <span class="st">"; Stim cluster:"</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">stim_clust</span>),
                   <span class="st">"; Fold change:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">fold_change</span>) ,  <span class="kw">sep</span><span class="kw">=</span><span class="st">" "</span>),
       <span class="kw">x</span> <span class="kw">=</span><span class="st">"Stim Status"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Cell Count %"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"K-means Cluster"</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">stacked_plot</span>)</pre></body></html></div>
<p><img src="stim_cell_selector_files/figure-html/stacked_plot-1.png" width="672"></p>
</div>
<div id="umap-plots-to-visually-inspect-responding-and-non-responding-cell-selection" class="section level4">
<h4 class="hasAnchor">
<a href="#umap-plots-to-visually-inspect-responding-and-non-responding-cell-selection" class="anchor"></a>UMAP Plots to Visually Inspect Responding and Non-Responding Cell Selection</h4>
<p>Note: You can only generate these plot if you have asked UMAPs to be calcualted in the <code><a href="../reference/stim_cell_selector.html">stim_cell_selector()</a></code> function.</p>
<p>UMAP plots can be useful for visually inspecting how well selection method has separated responding and non-responding cells for a cluster and stimulation type combination. The plots below shows all the cells from the unstimulated samples that fell in the unstim cluster and responding and non-responding cells from the stimulated samples that fell in the stim and unstim clusters respectively.</p>
<p>You can either use the function <code>plot_umap</code> provided in the package to plot for all the combinations of cluster and stimulation types in a specified folder like below</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_umap.html">plot_umap</a></span>(<span class="no">selected_data</span>, <span class="no">path</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>or use the backend code below to plot only for the combinations of interest or with custom aesthetics. The code below plots a UMAP for first combination using the output above.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># Group data according to clusters and stimulation type.</span>
<span class="no">group_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">selected_data</span>$<span class="no">umap_plot_data</span>, <span class="no">cluster</span>, <span class="no">stim_type</span>)

<span class="co"># Split groups into a list of individual tables.</span>
<span class="no">split_groups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span>(<span class="no">group_data</span>)

<span class="co"># Create ggplot for a single group.</span>
<span class="no">umap_plot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">UMAP1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">UMAP2</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">cell_type</span>)) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"Cell Type"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Cluster: "</span>, <span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">cluster</span>,
                                           <span class="st">"; Stim: "</span>, <span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">stim_type</span>,
                                            <span class="st">"\nTotal No. Cells: "</span>, <span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">tot_of_cells</span>,
                                            <span class="st">"; No. of Cells Plotted: "</span>, <span class="no">split_groups</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">no_of_cells</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="st">"UMAP1"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="st">"UMAP2"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">umap_plot</span>)</pre></body></html></div>
<p><img src="stim_cell_selector_files/figure-html/umap_plot-1.png" width="672"></p>
</div>
<div id="distribution-plots-for-individual-state-marker-before-and-after-selection" class="section level4">
<h4 class="hasAnchor">
<a href="#distribution-plots-for-individual-state-marker-before-and-after-selection" class="anchor"></a>Distribution plots for Individual State Marker before and after Selection</h4>
<p>You can either use the function <code>plot_kde</code> provided in the package to plot for all the combinations of cluster and stimulation types in a specified folder like below</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_kde.html">plot_kde</a></span>(<span class="no">original_data</span>, <span class="no">selected_data</span>, <span class="no">path</span>,<span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>or use the backend code below to plot only for the combinations of interest or with custom aesthetics. The code below plots a distribution plot for the first combination using the output above.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)

<span class="co"># Convert the pre k-means data from wide to long form for the state markers.</span>
<span class="no">original_data</span> <span class="kw">&lt;-</span> <span class="no">chi11_1k</span>$<span class="no">expr_data</span>
<span class="no">cluster_col</span> <span class="kw">&lt;-</span> <span class="no">chi11_1k</span>$<span class="no">cluster_col</span>
<span class="no">state_markers</span> <span class="kw">&lt;-</span> <span class="no">chi11_1k</span>$<span class="no">state_markers</span>
<span class="no">original_data</span> <span class="kw">&lt;-</span> <span class="no">original_data</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cluster_col</span>, <span class="st">"stim_type"</span>, <span class="no">state_markers</span>)]
<span class="no">gather_ori_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">5</span>)))
<span class="kw">for</span>(<span class="no">state</span> <span class="kw">in</span> <span class="no">state_markers</span>){
  <span class="no">temp_df</span> <span class="kw">&lt;-</span> <span class="no">original_data</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cluster_col</span>, <span class="st">"stim_type"</span>)]
  <span class="no">marker_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="no">original_data</span>[<span class="no">state</span>]), <span class="kw">key</span> <span class="kw">=</span> <span class="st">"state_marker"</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="st">"marker_exp"</span>)
  <span class="no">temp_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">temp_df</span>, <span class="no">marker_dat</span>, <span class="st">"distribution"</span> <span class="kw">=</span> <span class="st">"original"</span>)
  <span class="no">gather_ori_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">gather_ori_dat</span>, <span class="no">temp_df</span>)
}
<span class="no">gather_ori_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="no">gather_ori_dat</span>), <span class="st">"cluster"</span> <span class="kw">=</span> <span class="no">cluster_col</span>)

<span class="co"># Convert the post k-means data from wide to long form for the state markers.</span>
<span class="no">selec_data</span> <span class="kw">&lt;-</span> <span class="no">selected_data</span>$<span class="no">selected_expr_data</span>
<span class="no">selec_data</span> <span class="kw">&lt;-</span> <span class="no">selec_data</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cluster_col</span>, <span class="st">"stim_type"</span>, <span class="no">state_markers</span>)]
<span class="no">gather_selec_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">5</span>)))
<span class="kw">for</span>(<span class="no">state</span> <span class="kw">in</span> <span class="no">state_markers</span>){
  <span class="no">temp_df</span> <span class="kw">&lt;-</span> <span class="no">selec_data</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cluster_col</span>, <span class="st">"stim_type"</span>)]
  <span class="no">marker_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="no">selec_data</span>[<span class="no">state</span>]), <span class="kw">key</span> <span class="kw">=</span> <span class="st">"state_marker"</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="st">"marker_exp"</span>)
  <span class="no">temp_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">temp_df</span>, <span class="no">marker_dat</span>, <span class="st">"distribution"</span> <span class="kw">=</span> <span class="st">"selected"</span>)
  <span class="no">gather_selec_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">gather_selec_dat</span>, <span class="no">temp_df</span>)
}
<span class="no">gather_selec_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="no">gather_selec_dat</span>), <span class="st">"cluster"</span> <span class="kw">=</span> <span class="no">cluster_col</span>)

<span class="no">summary</span> <span class="kw">&lt;-</span> <span class="no">selected_data</span>$<span class="no">summary</span>
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">summary</span>)[<span class="fl">1</span>]){
  <span class="co"># Plot KDE of original (pre-k-means clustering) distribution overlaid</span>
  <span class="co"># by the KDE of the k-selected distribution.</span>
  <span class="no">cl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">summary</span><span class="kw">[[</span><span class="no">i</span>,<span class="fl">1</span>]])
  <span class="no">st</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">summary</span><span class="kw">[[</span><span class="no">i</span>,<span class="fl">2</span>]])

  <span class="no">clust_stim_k</span> <span class="kw">&lt;-</span> <span class="no">gather_selec_dat</span>[<span class="no">gather_selec_dat</span>$<span class="no">cluster</span> <span class="kw">==</span> <span class="no">cl</span> <span class="kw">&amp;</span> <span class="no">gather_selec_dat</span>$<span class="no">stim_type</span> <span class="kw">==</span> <span class="no">st</span>, ]
  <span class="no">clust_stim_ori</span> <span class="kw">&lt;-</span> <span class="no">gather_ori_dat</span>[<span class="no">gather_ori_dat</span>$<span class="no">cluster</span> <span class="kw">==</span> <span class="no">cl</span> <span class="kw">&amp;</span> <span class="no">gather_ori_dat</span>$<span class="no">stim_type</span> <span class="kw">==</span> <span class="no">st</span>, ]
  <span class="no">clust_stim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">clust_stim_ori</span>, <span class="no">clust_stim_k</span>))
  <span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">clust_stim</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">marker_exp</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">distribution</span>)) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.25</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"marker expression"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Cluster: "</span>, <span class="no">cl</span>, <span class="st">"; Stim Type: "</span>, <span class="no">st</span>))
  <span class="no">kde_plot</span> <span class="kw">&lt;-</span> <span class="no">p</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>( ~ <span class="no">state_marker</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_y"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>( <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>( <span class="kw">size</span> <span class="kw">=</span> <span class="fl">14</span> ),
           <span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>( <span class="kw">size</span> <span class="kw">=</span> <span class="fl">14</span> ),
           <span class="kw">axis.text.y</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>( <span class="kw">size</span> <span class="kw">=</span> <span class="fl">14</span> ),
           <span class="kw">axis.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>( <span class="kw">size</span> <span class="kw">=</span> <span class="fl">14</span>, <span class="kw">face</span> <span class="kw">=</span> <span class="st">"bold"</span> ),
           <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">14</span>, <span class="kw">face</span> <span class="kw">=</span> <span class="st">"bold"</span>))
}
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">kde_plot</span>)</pre></body></html></div>
<p><img src="stim_cell_selector_files/figure-html/umap_kde-1.png" width="672"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rohit Farmer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
